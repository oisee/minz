// Test bit-struct types

// 8-bit ZX Spectrum screen attributes
type ScreenAttr = bits {
    ink: 3,      // Bits 0-2
    paper: 3,    // Bits 3-5
    bright: 1,   // Bit 6
    flash: 1     // Bit 7
};

// 16-bit sprite control
type SpriteCtrl = bits<u16> {
    x_pos: 9,      // Bits 0-8 (0-511)
    visible: 1,    // Bit 9
    collision: 1,  // Bit 10
    palette: 2,    // Bits 11-12
    priority: 2,   // Bits 13-14
    flip_x: 1      // Bit 15
};

// Test functions
fn set_screen_attr(x: u8, y: u8, attr: ScreenAttr) -> void {
    let addr = 0x5800 + (y as u16) * 32 + (x as u16)
    // TODO: poke(addr, attr as u8)
}

fn test_bit_structs() -> void {
    // Test bit field access with a raw u8 for now
    let mut attr_raw: u8 = 0x47  // 01000111 = paper=0, ink=7, bright=1
    
    // For now test with regular variables since we need type conversion
    // This will test the bit field operations are generated
    let mut test_value: u8 = attr_raw
    
    // TODO: Once we have type conversion, we can do:
    // let mut attr: ScreenAttr = 0x47 as ScreenAttr
    // let ink = attr.ink     // Should extract bits 0-2
    // attr.paper = 5         // Should set bits 3-5
}

fn main() -> void {
    test_bit_structs()
}