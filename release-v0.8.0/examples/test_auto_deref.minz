// Test auto-dereferencing functionality

fun test_basic_auto_deref() -> u8 {
    var x: u8 = 10;
    var p: *u8 = &x;
    
    // Auto-deref: p = 20 becomes *p = 20
    p = 20;
    
    return x;  // Should return 20
}

fun test_pointer_arithmetic() -> u8 {
    var x: u8 = 10;
    var p: *u8 = &x;
    
    // Auto-deref both sides: p = p + 1 becomes *p = *p + 1
    p = p + 1;
    
    return x;  // Should return 11
}

// Test with TSMC references
@abi("smc")
fun increment_ptr(ptr: *u8) -> void {
    // This should update the TSMC immediate
    ptr = ptr + 1;
}

fun main() -> u8 {
    return test_basic_auto_deref();
}