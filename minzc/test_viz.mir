; MinZ Intermediate Representation (MIR)
; Module: main

; Globals:
;   test_viz.counter: u8

Function test_viz.factorial(n: u8) -> u8
  @smc
  @recursive
  Instructions:
      0: LOAD_PARAM
      1: r3 = 1
      2: r4 = r2 <= r3
      3: jump_if_not r4, else_1
      4: r5 = 1
      5: return r5
      6: jump end_if_2
      7: else_1:
      8: LOAD_PARAM
      9: LOAD_PARAM
     10: r8 = 1
     11: r9 = r7 - r8
     12: r10 = call factorial
     13: r11 = r6 * r10
     14: return r11
     15: end_if_2:
     16: return

Function test_viz.fibonacci(n: u8) -> u8
  @smc
  Locals:
    r6 = a: u8
    r8 = b: u8
    r10 = i: u8
    r15 = temp: u8
  Instructions:
      0: LOAD_PARAM
      1: r3 = 1
      2: r4 = r2 <= r3
      3: jump_if_not r4, else_3
      4: LOAD_PARAM
      5: return r5
      6: jump end_if_4
      7: else_3:
      8: end_if_4:
      9: r7 = 0
     10: store , r7
     11: r9 = 1
     12: store , r9
     13: r11 = 2
     14: store , r11
     15: loop_5:
     16: r12 = load i
     17: LOAD_PARAM
     18: r14 = r12 <= r13
     19: jump_if_not r14, end_loop_6
     20: r16 = load a
     21: r17 = load b
     22: r18 = r16 + r17
     23: store , r18
     24: r19 = load b
     25: store a, r19
     26: r20 = load temp
     27: store b, r20
     28: r21 = load i
     29: r22 = 1
     30: r23 = r21 + r22
     31: store i, r23
     32: jump loop_5
     33: end_loop_6:
     34: r24 = load b
     35: return r24

Function test_viz.main() -> void
  @smc
  Locals:
    r1 = result1: u8
    r4 = result2: u8
  Instructions:
      0: r2 = 5
      1: r3 = call factorial
      2: store , r3
      3: r5 = 10
      4: r6 = call fibonacci
      5: store , r6
      6: LOAD_STRING
      7: PRINT_STRING ; Print "Factorial(5) = " (15 chars via loop)
      8: r8 = load result1
      9: PRINT_U8
     10: PRINT_STRING_DIRECT ; Direct print "
" (1 chars)
     11: LOAD_STRING
     12: PRINT_STRING ; Print "Fibonacci(10) = " (16 chars via loop)
     13: r10 = load result2
     14: PRINT_U8
     15: PRINT_STRING_DIRECT ; Direct print "
" (1 chars)
     16: r11 = load test_viz.counter
     17: r12 = 1
     18: r13 = r11 + r12
     19: store counter, r13
     20: return

